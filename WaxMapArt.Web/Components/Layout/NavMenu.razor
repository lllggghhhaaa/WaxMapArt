@using System.Security.Claims
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider

<header class="sticky top-0 inset-x-0 flex flex-wrap md:justify-start md:flex-nowrap z-50 w-full text-sm">
  <nav class="mt-4 relative max-w-5xl w-full bg-white border border-gray-200 rounded-[24px] mx-2 flex flex-wrap md:flex-nowrap items-center justify-between p-2 px-4 sm:mx-auto dark:bg-neutral-900 dark:border-neutral-700" aria-label="Global">
    
    <div id="navMenu" class="flex flex-col md:flex-row md:items-center md:justify-start gap-2 md:gap-3 grow">
      <NavLink class="flex items-center gap-x-2 py-0.5 md:py-3 px-4 md:px-2 border-s-2 md:border-s-0 md:border-b-2 border-gray-800 font-medium text-gray-800 hover:text-gray-800 dark:border-neutral-200 dark:text-neutral-200 dark:hover:text-neutral-200" href="/">
        <i class="ri-artboard-2-line"></i>
        Map Generator
      </NavLink>
      <NavLink class="flex items-center gap-x-2 py-0.5 md:py-3 px-4 md:px-2 border-s-2 md:border-s-0 md:border-b-2 border-transparent text-gray-500 hover:text-gray-800 dark:text-neutral-400 dark:hover:text-neutral-200" href="palettes">
        <i class="ri-palette-line"></i>
        Palettes
      </NavLink>
      <NavLink class="flex items-center gap-x-2 py-0.5 md:py-3 px-4 md:px-2 border-s-2 md:border-s-0 md:border-b-2 border-transparent text-gray-500 hover:text-gray-800 dark:text-neutral-400 dark:hover:text-neutral-200" href="blocks">
        <i class="ri-box-2-fill"></i>
        Blocks
      </NavLink>
    </div>

    <div class="flex items-center gap-2 md:order-4 md:ms-4">
      <AuthorizeView>
        <Authorized>
          <div class="flex items-center gap-x-3">
            <div class="flex items-center gap-x-2">
              <img src="_content/MyApp/default-avatar.png" alt="User avatar" class="w-8 h-8 rounded-full border border-gray-300 dark:border-neutral-700 object-cover" />
              <span class="font-medium text-gray-800 dark:text-neutral-200">@_userName</span>
            </div>
            
            @if (_isDev)
            {
              <span class="inline-flex items-center rounded-full bg-pink-100 px-2 py-1 text-xs font-medium text-pink-800 ring-1 ring-inset ring-pink-600/20">
                <i class="ri-code-s-slash-line" />
              </span>
            }
          </div>
        </Authorized>
        <NotAuthorized>
          <div class="inline-flex items-center gap-x-3">
            <NavLink class="w-full sm:w-auto whitespace-nowrap py-2 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-full border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 focus:outline-hidden focus:bg-gray-100 dark:bg-neutral-800 dark:text-neutral-200 dark:hover:bg-neutral-700" href="login">
              Log In
            </NavLink>
            <NavLink class="w-full sm:w-auto whitespace-nowrap py-2 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-full bg-gray-900 text-white hover:bg-gray-800 focus:outline-hidden focus:bg-gray-700 dark:bg-white dark:text-neutral-900 dark:hover:bg-neutral-200" href="signin">
              Sign In
            </NavLink>
          </div>
        </NotAuthorized>
      </AuthorizeView>

      <div class="md:hidden">
        <button type="button"
                class="hs-collapse-toggle flex justify-center items-center size-9.5 border border-gray-200 text-gray-500 rounded-full hover:bg-gray-200 focus:outline-hidden focus:bg-gray-200 dark:border-neutral-700 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700"
                aria-label="Alternar navegação"
                aria-controls="navMenu"
                data-hs-collapse="#navMenu">
          <svg class="hs-collapse-open:hidden shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <svg class="hs-collapse-open:block hidden shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>
</header>

@code {
    private string? _userName;
    private bool _isDev = false;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        
        _userName = authState.User.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Name)?.Value ?? "Guest";
        _isDev = authState.User.Claims.Any(claim => claim is { Type: ClaimTypes.Role, Value: "Developer" });
        
        StateHasChanged();
    }
}